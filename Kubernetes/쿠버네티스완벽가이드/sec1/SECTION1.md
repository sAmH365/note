# 1장 도커 복습과 Hello, Kubernetes
## 1.1 도커 복습
* 도커
  * 컨테이너를 실행하기위한 실행환경(컨테이너 런타임) 및 툴킷
  * 주로 필요한 내용은 도커 이미지에 대한 지식
* 쿠버네티스 사용시 도커에 대해 알아두면 좋은 지식
    1. 도커 컨테이너 설계
    2. 도커 파일 작성법
    3. 도커 이미지 빌드
    4. 도커 레지스트리로 이미지 푸시
* 도커컨테이너
  * 도커 이미지를 기반으로 실행되는 프로세스
  * BORA(Build once, Run Anyware)컨셉 , (자바는 WORA(Wirte once, Run Anyware))
  * 가상 머신에 비해 '가볍다', '시작과 중지가 빠르다'
    * 가상머신은 하이퍼바이저를 이용하여 게스트 OS동작
    * 도커컨테이너는 호스트 머신의 커널을 이용 -> 네임스페이스 분리와 cgroups를 이용한 제어

### 1.1.2 도커 컨테이너 설계
#### 컨테이너 생성시 주의점
##### 1. 1컨테이너당 1프로세스
* 가장 주용한 부분 -> 기존 가상머신처럼 한개의 이미지안에 여러 프로세스를 올리는 방법은 추천 X
##### 2. 변경 불가능한 인프라 이미지로 생성
* 변경불가능한 인프라
  * 환경을 변경할 때 오래된 환경은 없애고 새로운 환경을 만든다
  * 한번 만들어진 환경은 절대 변경되지 않게 한다.
  * 예시
    * 컨테이너 기동후 외부에서 실행 바이너리를 가져오거나 패키지를 설치하면, 외부 영향에 따라 컨테이너 이미지 실행결과가 달라진다.
    * 되도록 컨테이너 이미지 안에 실행 바이너리나 관련 리소스를 포함시켜 컨테이너 이미지를 변경 불가능한 상태로 만들자
##### 3. 경량 도커이미지로 생성
* 로컬에 사용할 도커 이미지 없으면 외부에서 풀해서 사용 -> 가급적 경량인 상태로 만들어야 한다.
* 기본이미지(base image)가 경량인 배포판 이미지를 사용
  * 알파인 리눅스(AlpineLinux)
  * Distroless
    * 파이썬이나 노드등 특정 애플리케이션 런타임만 포함
##### 4. 실행 계정은 root이외의 사용자로 한다 
* 컨테이너 내부에서 프로세스를 기동하는 실행 계정 권한을 최소화 하자.

### 1.1.3 도커 파일 작성법
```docker
# Alpine 3.11 버전 golang 1.14.1 이미지를 기반 이미지로 사용
FROM golang:1.14.1-alpine3.11

# 빌드할 머신에 있는 main.go 파일을 컨테이너에 복사
COPY ./main.go ./

# 빌드 시 컨테이너 내부에서 명령어 실행
RUN go build -o ./go-app ./main.go

# 실행 계정을 nobody로 지정
USER nobody

# 컨테이너가 기동할 때 실행할 명령어 정의 
ENTRYPOINT ["./go-app"]
```
* 도커파일의 기본적인 흐름
  * FROM에서 기반이미지 지정
  * RUN이나 COPY등의 명령을 사용해 패키지 설치나 파일 복사등의 여러가지 처리 후 이미지 생성
#### 멀티 스테이지 빌드
* 여러 컨테이너 이미지를 사용하여 처리하고 결과물만 실행용 컨테이너 이미지에 복사하는 구조
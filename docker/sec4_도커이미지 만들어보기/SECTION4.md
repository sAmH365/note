### 직접 도커 이미지 만들어 보기

* 도커 이미지는 컨테이너를 만들기 위해 필요한 설정이나 종속성들을 갖고있는 소프트웨어 패키지
* 도커 이미지는 도커허브에 이미 다른 사람들이 만들어 놓은것을 이용 할 수도 있고, 직접 도커 이미지를 만들어서 사용할 수도있고, 만든것을 도커허브에 업로드 할 수도 있다.
* 도커 이미지 생성하는 순서
  * 도커 파일 작성 -> 도커 클라이언트  ->  도커 서버  ->  이미지 생성
    * 도커 파일
      * 도커 이미지를 만들기 위한 설정파일, 컨테이너가 어떻게 행동해야 하는지에 대한 설정들을 정의
    * 도커 클라이언트
      * 도커 파일에 입력된 것들이 도커 클라이언트에 전달되어야한다.
    * 도커 서버
      * 도커 클라이언트에 전달된 모든 중요한 작업들을 하는 곳
### 도커 파일 만들기
* 도커파일
  * 도커 이미지를 만딜기 위한 설정 파일
  * 컨테이너가 어떻게 행동해야 하는지에 대한 설정들을 정의해준다.
* 도커 파일 만드는 순서(도커 이미지가 필요한 것이 무엇인지를 생각하기)
  1. 베이스 이미지를 명시해준다. (파일 스냅샷에 해당)
  2. 추가적으로 필요한 파일을 다운 받기 위한 몇가지 명령어를 명시해준다.(파일 스냅샷에 해당)
  3. 컨테이너 시작시 실행 될 명령어를 명시해준다. (시작시실행 될 명령어에 해당)
  * 베이스 이미지는 무엇인가
    * 도커 이미지는 여러개의 레이어로 되어있다. 그 중에서 베이스 이미지는 이 이미지의기반이 되는 부분이다.
    * OS라고 생각하면 편함
    * 제로에서 도커 이미지를 만드는 방법도 있지만, 사용자들은 일반적으로 도커에서 제공하는 리눅스 배포판 이미지를 베이스 이미지로 삼아 커스텀이미지를 만든다.
* 완성된 도커 파일로 이미지 생성 방법
  * 도커파일 -->  도커 클라이언트 --> 도커 서버 --> 이미지
    * 도커 파일에 입력된 것들이 도커 클라이언트에 전달되어서 도커 서버가 인식하게 해야한다.
    * `docker build .`
    * 해당 디렉토리 내에서 dockerfile이라는 파일을 찾아 도커 클라이언트에게 전달시켜 준다. 
    1. Alpine이미지의 베이스 이미지 + 각 레이어의 이미지를 임시 컨테이너에 생성
       1. 임시 컨테이너에 시작시 실행될 커맨드 추가
    2. 임시컨테이너를 토대로 Alpine이미지 생성
    3. 임시 컨테이너 삭제
  * 베이스 이미지에서 다른 종속성이나 새로운 커맨드를 추가 할 때는 임시 컨테이너를 만든 후 그 컨테이너를 토대로 새로운 이미지를 만든다. (후에 임시 컨테이너는 지워준다.)
    * Buildkit이 기본적으로 enable 되는 현상
      * 도커 2.4.0+ 버전 업데이트로 빌드킷을 기본적으로 사용가능
      * 빌드할때 출력되는 문구 변경되었음
      * 빌드킷 비활성화 방법
        * 설정 > Docker Engine탭 > buildkit 값을 false로 변경
      * 설정을 완료하면 임시컨테이너 생성하는 스텝별로 출력됨
### 만든 이미지 이름 주기
* `docker build -t samh273766/hello:latest`
* `-t [도커 유저네임]/[저장소 or 프로젝트이름] : 버전`
* 도커 허브에 푸시
  * `docker push samh5370/hello-docker:latest`